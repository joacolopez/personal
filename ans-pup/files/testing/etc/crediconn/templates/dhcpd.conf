PATH: /etc/dhcp/dhcpd.conf
# Version de puppet 1.3 - 16-Dic-2019
# Inclusion de multiples segmentos para nuevas estaciones de filial.
# Se agrega función de UCASE para evitar errores de syntaxis.
# ==================================================================
class "EquiposTelefonicos" {
	match if 
	# MACs de YeaLink
	(substring (hardware, 1, 3) = 00:15:65) or 
	# hostname que arranca con ATA
	(ucase(substring(option host-name,0,3)) = "ATA") ;
}

# Switches Cisco/Linksys
class "Switches" {
	# Los nombres de host para los Switches, deben empezar con TOR
	match if 
	(ucase(substring(option host-name,0,3)) = "TOR") or
	(ucase(substring(option host-name,0,2)) = "SW");
}

class "Notebooks" {
	match hardware;
	#match option dhcp-client-identifier;
}
include "/etc/dhcp/dhcpd-subclass-notebooks.conf";

class "videoVigilancia" {
	match if
	(ucase(substring(option host-name,0,3)) = "DVR") or
	(ucase(substring(option host-name,0,4)) = "HCVR") or
	(substring (hardware, 1, 3) = 3c:ef:8c) ;
}

class "CamarasIP" {
	match if
	(ucase(substring(option host-name,0,3)) = "IPC") or
	(substring (hardware, 1, 3) = 14:a7:8b) ;
}

# Estaciones de trabajo nueva plataforma
class "WorkStations" {
	# Los nombres de host para los puestos, deben empezar con wst
	match if 
	(ucase(substring(option host-name,0,3)) = "WST");
}

# Servidores de la LAN de filiales.
class "Servers" {
	# Los nombres de host para los puestos, deben empezar con wst
	match if 
	(ucase(substring(option host-name,0,3)) = "SRV");
}

# ==================================================================
# ==================================================================
ddns-update-style none;
default-lease-time 600;
max-lease-time 7200;
min-lease-time 1800;
log-facility local7;

option wpad code 252 =    text;
# ==================================================================
subnet  %(net_prefix_drago)s.0 netmask 255.255.255.0 {
        one-lease-per-client            on;
        ignore client-updates;		#Ignore all client requests for DDNS update
        default-lease-time 7200;	# Corresponde a una hora
        max-lease-time 14400;		# Corresponde a cuatro horas

        option ip-forwarding            off;
        option subnet-mask              255.255.255.0;
        option broadcast-address        %(net_prefix_drago)s.255;
        option routers                  %(net_prefix_drago)s.254;
        option domain-name              "%(filial_zone)s";
        option domain-search            "bancocredicoop.coop";
        option domain-name-servers      %(net_prefix_drago)s.254, 10.1.2.217;
        option netbios-name-servers     %(net_prefix_drago)s.2;
        option netbios-node-type        8;
        option interface-mtu            1350;

        option smtp-server              smtp.bancocredicoop.coop;
        #option imap-server             imap.bancocredicoop.coop;
        option irc-server               svjab01lx.bancocredicoop.coop;
        option wpad "http://proxyfil.bancocredicoop.coop/proxy.pac\n";

        option time-offset              -10800; # -3:00hs
        option ntp-servers              %(net_prefix_drago)s.254, 10.1.1.88, 10.1.1.89;
        option time-servers             %(net_prefix_drago)s.2;


        # Direcciones IP fijas.
        include "/etc/dhcp/dhcpd-ip-fijas.conf";


        # Pool de direcciones para Notebooks en filiales.
        # Principalmente ROZ y Auditoría.
        pool {
                allow members of "Notebooks";
                #include "/etc/dhcp/dhcp-ws-banco.conf" ;
                range %(net_prefix_drago)s.123 %(net_prefix_drago)s.126;
        }

        pool {
                allow members of "CamarasIP";
                range %(net_prefix_drago)s.129 %(net_prefix_drago)s.184;
        }

        pool {
                allow members of "EquiposTelefonicos";
                range %(net_prefix_drago)s.201 %(net_prefix_drago)s.206;
        }

        # Rango de direcciones para equipos de comunicaciones.
        pool {
				# 254 , 253 y 252 están reservados para el NodoVPN.
                allow members of "Switches";
                range %(net_prefix_drago)s.241 %(net_prefix_drago)s.251;
                default-lease-time 1800; # Corresponde a 5 horas.
                max-lease-time 28800;   # Corresponde a cuatro horas
                min-lease-time 3600; # Corresponde a 1hs.
        }

        # Rango de direcciones para TAS y FDV.
        pool {
                deny all clients;
                range %(net_prefix_drago)s.209 %(net_prefix_drago)s.222;
        }

        # Rango para servidores en la filial
        pool {
                allow members of "Servers";
				# La dirección 1 y 2 son de este rango, pero se excluye 
				# de la asignación.
				# tambien se excluyen las direcciones 3 y 4 para la filial 664
				# reservadas para puestos W2K
                range %(net_prefix_drago)s.5 %(net_prefix_drago)s.15;
        }

        # Pool de direcciones para DVRs filiales.
        pool {
                allow members of "videoVigilancia";
                range %(net_prefix_drago)s.185 %(net_prefix_drago)s.190;
        }

        # Pool de direcciones para WSs filiales.
        pool {
                allow members of "WorkStations";
                range %(net_prefix_drago)s.16 %(net_prefix_drago)s.122;
        }
}
