PATH: /etc/dhcp/dhcpd.conf

# Version de puppet 1.1 - Marzo - 2019
# Inclusión de segmento para SwitchesCisco-Linksys.
# ==============================================
class "TelefonosYealink" {
        # Corresponde al rango MAC de esta marca.
        match if substring (hardware, 1, 3) = 00:15:65;
	lease limit 2;
}

class "TelefonosFijos" {
        match hardware;
        #match option dhcp-client-identifier;
        lease limit 1;
}

# Switches Cisco/Linksys
class "Switches" {
	# Los nombres de host para los Switches, deben empezar con TOR
        match if (substring(option host-name,0,3) = "TOR");
        #match if (option host-name = "TOR-Filial");
	# Cantidad de pedidos de IP permitidas.
        lease limit 3;
}

class "Notebooks" {
	match hardware;
	#match option dhcp-client-identifier;
	lease limit 2;
}
include "/etc/dhcp/dhcpd-subclass-notebooks.conf";

class "DVR" {
	match if (substring(option host-name,0,3) = "DVR");
        lease limit 3;
}


# ==============================================
ddns-update-style none;
default-lease-time 600;
max-lease-time 7200;
min-lease-time 1800;
log-facility local7;

option wpad code 252 =    text;
# ==============================================
subnet  %(net_prefix_drago)s.0 netmask 255.255.255.0 { 
	one-lease-per-client 		on;
	ignore client-updates; #Ignore all client requests for DDNS update
	default-lease-time 7200; # Corresponde a una hora
	max-lease-time 14400;	# Corresponde a cuatro horas

	option ip-forwarding            off;
	option subnet-mask		255.255.255.0;
	option broadcast-address	%(net_prefix_drago)s.255;
	option routers			%(net_prefix_drago)s.254;
	option domain-name		"%(filial_zone)s";
	option domain-search		"bancocredicoop.coop";
	option domain-name-servers	%(net_prefix_drago)s.254, 10.1.2.217;
	option netbios-name-servers	%(net_prefix_drago)s.2;
	option netbios-node-type	8;
	option interface-mtu		1350;

	option smtp-server		smtp.bancocredicoop.coop;
	#option imap-server		imap.bancocredicoop.coop;
	option irc-server		svjab01lx.bancocredicoop.coop;
	option wpad "http://proxyfil.bancocredicoop.coop/proxy.pac\n";

	option time-offset		-10800; # -3:00hs
	option ntp-servers		%(net_prefix_drago)s.254, 10.1.1.88, 10.1.1.89;
	option time-servers		%(net_prefix_drago)s.2;

        # Direcciones IP fijas.
        include "/etc/dhcp/dhcpd-ip-fijas.conf";


	# Pool de direcciones para Notebooks en filiales.
	# Principalmente ROZ y Auditoría.
	pool {
		allow members of "Notebooks";
		#include "/etc/dhcp/dhcp-ws-banco.conf" ;
		range %(net_prefix_drago)s.188 %(net_prefix_drago)s.191;
	}
 
	# Pool de direcciones para TelefonosFijos.
	pool {
		allow members of "TelefonosFijos";
		allow members of "TelefonosYealink";
		range %(net_prefix_drago)s.169 %(net_prefix_drago)s.174;
	}

        # Rango de direcciones para administración de switches.
        pool {  
                allow members of "Switches";
		range %(net_prefix_drago)s.176 %(net_prefix_drago)s.181;
		default-lease-time 1800; # Corresponde a 5 horas.
		max-lease-time 28800;	# Corresponde a cuatro horas
		min-lease-time 3600; # Corresponde a 1hs.
        }

	# Rango de direcciones para Cajeros Automaticos.
	pool {
		deny all clients;
		range %(net_prefix_drago)s.208 %(net_prefix_drago)s.215;
	}

	# Rango para servidores en la filial
	pool {
		deny all clients;
		range %(net_prefix_drago)s.1 %(net_prefix_drago)s.2;
	}

	# Pool de direcciones para DVRs filiales.
  
        pool {
                allow members of "DVR";
                range %(net_prefix_drago)s.216 %(net_prefix_drago)s.220;
	}

}
